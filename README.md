# mahjong-cpp

## About (æ¦‚è¦)

æ—¥æœ¬ã®ãƒªãƒ¼ãƒéº»é›€ã®ãƒ—ãƒ­ã‚°ãƒ©ãƒ ç½®ãå ´

Miscellaneous programs about Japanese Mahjong

## Features (æ©Ÿèƒ½)

ğŸš§This program is under development. Currently the following features have been implemented.ğŸš§

* [x] å‘è´æ•°è¨ˆç®— (Syanten Number Calculation)
* [x] ç‚¹æ•°è¨ˆç®— (Score Calculation)
* [x] æœ‰åŠ¹ç‰Œåˆ—æŒ™ (Required Tile Selection)
* [x] ä¸è¦ç‰Œåˆ—æŒ™ (Unnecessary Tile Selection)
* [x] æœŸå¾…å€¤è¨ˆç®— (Expected Score Calculation)
  * [x] å‘è´æˆ»ã—è€ƒæ…®
  * [x] ä¸€ç™ºã€æµ·åº•æ’ˆæœˆè€ƒæ…®
  * [ ] è£ãƒ‰ãƒ©è€ƒæ…®
  * [ ] å‘è´æ•°ãŒå¤‰åŒ–ã—ãªã„æ‰‹å¤‰ã‚ã‚Šè€ƒæ…®
  * [ ] æ§“ã•ã‚Œã¦ã„ã‚‹å ´åˆã‚’è€ƒæ…®

## Requirements (ä¾å­˜ãƒ©ã‚¤ãƒ–ãƒ©ãƒª)

* [Boost C++ Libraries](https://www.boost.org/) >= 1.61
* [CMake](https://cmake.org/) >= 3.1.1

## How to build (ãƒ“ãƒ«ãƒ‰æ–¹æ³•)

```bash
git clone https://github.com/nekobean/mahjong-cpp.git
cd mahjong-cpp
mkdir build
cd build
cmake ..
```

## Usage (ä½¿ã„æ–¹)

* [å‘è´æ•°è¨ˆç®— (Syanten Number Calculation)](src/samples/sample_calculate_syanten.cpp)
* [ç‚¹æ•°è¨ˆç®— (Score Calculation)](src/samples/sample_calculate_score.cpp)
* [æœ‰åŠ¹ç‰Œé¸æŠ (Required Tile Selection)](src/samples/sample_required_tile_selector.cpp)
* [ä¸è¦ç‰Œé¸æŠ (Unnecessary Tile Selection)](src/samples/sample_unnecessary_tile_selector.cpp)
* [æœŸå¾…å€¤è¨ˆç®— (Expected Value Calculation)](src/samples/sample_calculate_expexted_value.cpp)

### ç‚¹æ•°è¨ˆç®—ã®ä¾‹

```cpp
#include "mahjong/mahjong.hpp"

using namespace mahjong;

int main(int, char **)
{
    ScoreCalculator score;

    // å ´ã‚„ãƒ«ãƒ¼ãƒ«ã®è¨­å®š
    score.set_bakaze(Tile::Ton);  // å ´é¢¨ç‰Œ
    score.set_zikaze(Tile::Ton);  // è‡ªé¢¨ç‰Œ
    score.set_num_tumibo(0);  // ç©ã¿æ£’ã®æ•°
    score.set_num_kyotakubo(0);  // ä¾›è¨—æ£’ã®æ•°
    score.set_dora_tiles({Tile::Pe});  // ãƒ‰ãƒ©ã®ä¸€è¦§ (è¡¨ç¤ºç‰Œã§ã¯ãªã„)
    score.set_uradora_tiles({Tile::Pinzu9});  // è£ãƒ‰ãƒ©ã®ä¸€è¦§ (è¡¨ç¤ºç‰Œã§ã¯ãªã„)

    // æ‰‹ç‰Œã€å’Œäº†ç‰Œã€ãƒ•ãƒ©ã‚°ã®è¨­å®š
    // æ‰‹ç‰Œ
    MeldedBlock block(MeldType::Kakan, {Tile::Ton, Tile::Ton, Tile::Ton, Tile::Ton});
    Hand hand({Tile::Manzu1, Tile::Manzu2, Tile::Manzu3, Tile::Pinzu3, Tile::Pinzu4,
                Tile::Pinzu5, Tile::Sozu1, Tile::Sozu2, Tile::Sozu3, Tile::Sozu4, Tile::Sozu4},
                {block});
    int win_tile = Tile::Manzu1;  // å’Œäº†ç‰Œ
    int flag = HandFlag::Tumo | HandFlag::Rinsyankaiho;  // ãƒ•ãƒ©ã‚°

    // ç‚¹æ•°è¨ˆç®—
    Result ret = score.calc(hand, win_tile, flag);
    std::cout << ret.to_string() << std::endl;
}
```

```output
[çµæœ]
æ‰‹ç‰Œ: 123m 345p 12344s [æ±æ±æ±æ±, åŠ æ§“], å’Œäº†ç‰Œ: ä¸€è¬, è‡ªæ‘¸
é¢å­æ§‹æˆ:
  [æ±æ±æ±æ±, æ˜æ§“å­]
  [ä¸€è¬äºŒè¬ä¸‰è¬, æš—é †å­]
  [ä¸‰ç­’å››ç­’äº”ç­’, æš—é †å­]
  [ä¸€ç´¢äºŒç´¢ä¸‰ç´¢, æš—é †å­]
  [å››ç´¢å››ç´¢, æš—å¯¾å­]
å¾…ã¡: ä¸¡é¢å¾…ã¡
å½¹:
 å¶ºä¸Šé–‹èŠ± 1ç¿»
 è‡ªé¢¨ (æ±) 1ç¿»
 å ´é¢¨ (æ±) 1ç¿»
40ç¬¦3ç¿»
```

### æœŸå¾…å€¤è¨ˆç®—ã®ä¾‹

```
æ‰‹ç‰Œ: 2345m 113479p 6778s, å‘è´æ•°: 1, å·¡ç›®: 1
[æ‰“ ä¹ç­’ (å‘è´æˆ»ã—)] æœ‰åŠ¹ç‰Œ: 19ç¨®64æš, è´ç‰Œç¢ºç‡: 87.95%, å’Œäº†ç¢ºç‡: 39.02%, æœŸå¾…å€¤: 1843.78 æœ‰åŠ¹ç‰Œ ä¸€è¬ ä¸€ç­’ äºŒè¬ äºŒç­’ ä¸‰è¬ å››è¬ äº”è¬ äº”ç­’ äº”ç´¢ å…­è¬ å…­ç­’ å…­ç´¢ ä¸ƒè¬ ä¸ƒç­’ 
ä¸ƒç´¢ å…«ç­’ å…«ç´¢ ä¹ç­’ ä¹ç´¢
[æ‰“ ä¸ƒç­’ (å‘è´æˆ»ã—)] æœ‰åŠ¹ç‰Œ: 18ç¨®60æš, è´ç‰Œç¢ºç‡: 87.50%, å’Œäº†ç¢ºç‡: 37.27%, æœŸå¾…å€¤: 1752.13 æœ‰åŠ¹ç‰Œ ä¸€è¬ ä¸€ç­’ äºŒè¬ äºŒç­’ ä¸‰è¬ å››è¬ äº”è¬ äº”ç­’ äº”ç´¢ å…­è¬ å…­ç´¢ ä¸ƒè¬ ä¸ƒç­’ ä¸ƒç´¢ 
å…«ç­’ å…«ç´¢ ä¹ç­’ ä¹ç´¢
[æ‰“ äºŒè¬] æœ‰åŠ¹ç‰Œ: 3ç¨®12æš, è´ç‰Œç¢ºç‡: 85.23%, å’Œäº†ç¢ºç‡: 32.41%, æœŸå¾…å€¤: 1563.97 æœ‰åŠ¹ç‰Œ äºŒç­’ äº”ç­’ å…«ç­’
[æ‰“ äº”è¬] æœ‰åŠ¹ç‰Œ: 3ç¨®12æš, è´ç‰Œç¢ºç‡: 85.23%, å’Œäº†ç¢ºç‡: 32.41%, æœŸå¾…å€¤: 1563.97 æœ‰åŠ¹ç‰Œ äºŒç­’ äº”ç­’ å…«ç­’
[æ‰“ ä¸ƒç´¢] æœ‰åŠ¹ç‰Œ: 3ç¨®12æš, è´ç‰Œç¢ºç‡: 85.23%, å’Œäº†ç¢ºç‡: 33.65%, æœŸå¾…å€¤: 1541.07 æœ‰åŠ¹ç‰Œ äºŒç­’ äº”ç­’ å…«ç­’
[æ‰“ å››ç­’ (å‘è´æˆ»ã—)] æœ‰åŠ¹ç‰Œ: 18ç¨®60æš, è´ç‰Œç¢ºç‡: 79.70%, å’Œäº†ç¢ºç‡: 25.55%, æœŸå¾…å€¤: 1110.55 æœ‰åŠ¹ç‰Œ ä¸€è¬ ä¸€ç­’ äºŒè¬ äºŒç­’ ä¸‰è¬ ä¸‰ç­’ å››è¬ å››ç­’ äº”è¬ äº”ç­’ äº”ç´¢ å…­è¬ å…­ç´¢ ä¸ƒè¬ 
ä¸ƒç´¢ å…«ç­’ å…«ç´¢ ä¹ç´¢
[æ‰“ ä¸‰ç­’ (å‘è´æˆ»ã—)] æœ‰åŠ¹ç‰Œ: 19ç¨®64æš, è´ç‰Œç¢ºç‡: 76.47%, å’Œäº†ç¢ºç‡: 24.38%, æœŸå¾…å€¤: 1064.24 æœ‰åŠ¹ç‰Œ ä¸€è¬ ä¸€ç­’ äºŒè¬ äºŒç­’ ä¸‰è¬ ä¸‰ç­’ å››è¬ å››ç­’ äº”è¬ äº”ç­’ äº”ç´¢ å…­è¬ å…­ç­’ å…­ç´¢ 
ä¸ƒè¬ ä¸ƒç´¢ å…«ç­’ å…«ç´¢ ä¹ç´¢
[æ‰“ å…«ç´¢ (å‘è´æˆ»ã—)] æœ‰åŠ¹ç‰Œ: 7ç¨®23æš, è´ç‰Œç¢ºç‡: 76.19%, å’Œäº†ç¢ºç‡: 23.76%, æœŸå¾…å€¤: 1045.61 æœ‰åŠ¹ç‰Œ ä¸€ç­’ äºŒç­’ äº”ç­’ äº”ç´¢ ä¸ƒç´¢ å…«ç­’ å…«ç´¢
[æ‰“ å…­ç´¢ (å‘è´æˆ»ã—)] æœ‰åŠ¹ç‰Œ: 7ç¨®23æš, è´ç‰Œç¢ºç‡: 76.19%, å’Œäº†ç¢ºç‡: 23.76%, æœŸå¾…å€¤: 1045.61 æœ‰åŠ¹ç‰Œ ä¸€ç­’ äºŒç­’ äº”ç­’ å…­ç´¢ ä¸ƒç´¢ å…«ç­’ ä¹ç´¢
[æ‰“ ä¸‰è¬ (å‘è´æˆ»ã—)] æœ‰åŠ¹ç‰Œ: 5ç¨®19æš, è´ç‰Œç¢ºç‡: 67.61%, å’Œäº†ç¢ºç‡: 20.34%, æœŸå¾…å€¤: 932.00 æœ‰åŠ¹ç‰Œ äºŒç­’ ä¸‰è¬ äº”ç­’ å…­è¬ å…«ç­’
[æ‰“ å››è¬ (å‘è´æˆ»ã—)] æœ‰åŠ¹ç‰Œ: 5ç¨®19æš, è´ç‰Œç¢ºç‡: 67.61%, å’Œäº†ç¢ºç‡: 20.34%, æœŸå¾…å€¤: 932.00 æœ‰åŠ¹ç‰Œ ä¸€è¬ äºŒç­’ å››è¬ äº”ç­’ å…«ç­’
[æ‰“ ä¸€ç­’ (å‘è´æˆ»ã—)] æœ‰åŠ¹ç‰Œ: 8ç¨®25æš, è´ç‰Œç¢ºç‡: 73.76%, å’Œäº†ç¢ºç‡: 21.89%, æœŸå¾…å€¤: 911.94 æœ‰åŠ¹ç‰Œ ä¸€ç­’ äºŒè¬ äºŒç­’ å››ç­’ äº”è¬ äº”ç­’ ä¸ƒç´¢ å…«ç­’
è¨ˆç®—æ™‚é–“: 5194us
```

## Benchmark (ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯)

* Coreâ„¢ i9-9900K 3.6 GHz

### å‘è´æ•°è¨ˆç®—

|      | N=40000 | 1æ‰‹ã‚ãŸã‚Šã®å¹³å‡è¨ˆç®—æ™‚é–“  |
|------|--------------------|-------------|
| ä¸€èˆ¬æ‰‹  | 576 us           | 14.4ns |
| ä¸ƒå¯¾å­æ‰‹ | 240 us          | 6.0ns |
| å›½å£«æ‰‹  | 147 us           | 3.7ns |

### ç‚¹æ•°è¨ˆç®—

|      | N=410831 | 1æ‰‹ã‚ãŸã‚Šã®å¹³å‡è¨ˆç®—æ™‚é–“  |
|------|--------------------|-------------|
| ä¸€èˆ¬æ‰‹  | 128ms              | 311ns |

### ä¸è¦ç‰Œé¸æŠ

|      | N=100000 | 1æ‰‹ã‚ãŸã‚Šã®å¹³å‡è¨ˆç®—æ™‚é–“  |
|------|--------------------|-------------|
| ä¸€èˆ¬æ‰‹  | 33 ms           | 330ns |
| ä¸ƒå¯¾å­æ‰‹ | 21 ms          | 210ns |
| å›½å£«æ‰‹  | 12 ms           | 120ns |

### æœ‰åŠ¹ç‰Œé¸æŠ

|      | N=100000 | 1æ‰‹ã‚ãŸã‚Šã®å¹³å‡è¨ˆç®—æ™‚é–“  |
|------|--------------------|-------------|
| ä¸€èˆ¬æ‰‹  | 62 ms           | 620ns |
| ä¸ƒå¯¾å­æ‰‹ | 35 ms          | 350ns |
| å›½å£«æ‰‹  | 13 ms           | 130ns |
